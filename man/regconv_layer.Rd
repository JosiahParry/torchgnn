% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/layer-regconv.R
\name{regconv_layer}
\alias{regconv_layer}
\title{Regional GCN Convolutional Layer (Guo et al. 2025)}
\usage{
regconv_layer(in_features, out_features, n_regions)
}
\arguments{
\item{in_features}{Integer. Number of input features per node}

\item{out_features}{Integer. Number of output features per node}

\item{n_regions}{Integer. Number of spatial regions/regimes}

\item{x}{Tensor \verb{n_nodes x in_features}. Node feature matrix}

\item{adj}{Tensor \verb{n_nodes x n_nodes}. Adjacency matrix. Expected to be row-normalized
\eqn{D^{-1}A} where \eqn{D} is the degree matrix. Can be binary or weighted}

\item{region_assignments}{Tensor \code{n_nodes}. Integer vector with values in \code{1:n_regions},
indicating which region each node belongs to. Multiple nodes can belong to the same region}

\item{edge_weight}{Tensor \verb{n_nodes x n_nodes} or NULL. Optional edge weights to
apply to the adjacency matrix. If NULL, uses values from \code{adj}. Default: NULL}
}
\value{
Tensor \verb{n_nodes x out_features}. Transformed node features (before activation)
}
\description{
Implements the Regional Graph Convolutional Network (RegConv) layer from Guo et al. (2025):

\deqn{\mathbf{X}^{(l)} = \sigma\left(\left(\mathbf{D}^{-1}\mathbf{A}\mathbf{X}^{(l-1)}\boldsymbol{\Theta}^{(l)} + \mathbf{X}^{(l-1)}\boldsymbol{\Phi}^{(l)}\right)\boldsymbol{\Omega}_{reg}^{(l)} + \boldsymbol{\Psi}_{reg}^{(l)}\right)}

This layer extends the standard GCN layer by introducing region-specific parameters to
handle spatial heterogeneity (spatial regimes). The computation has two stages:
\enumerate{
\item \strong{Base GCN transformation}: \eqn{\mathbf{D}^{-1}\mathbf{A}\mathbf{X}^{(l-1)}\boldsymbol{\Theta}^{(l)} + \mathbf{X}^{(l-1)}\boldsymbol{\Phi}^{(l)}}
\item \strong{Region-specific modulation}: Element-wise multiplication by \eqn{\boldsymbol{\Omega}_{reg}} and addition of \eqn{\boldsymbol{\Psi}_{reg}}
}

Parameters:
\itemize{
\item \eqn{\Theta} (theta): \verb{in_features x out_features} transforms aggregated neighbor features (global)
\item \eqn{\Phi} (phi): \verb{in_features x out_features} transforms node's own features (global)
\item \eqn{\Omega_{reg}} (omega_reg): \verb{n_regions x out_features} region-specific weight modulation
\item \eqn{\Psi_{reg}} (psi_reg): \verb{n_regions x out_features} region-specific bias terms
}
}
\details{
The RegConv layer is designed for two-stage training:

\strong{Stage 1}: Train a global GCN to learn \eqn{\Theta} and \eqn{\Phi}, then freeze these parameters.

\strong{Stage 2}: Initialize \eqn{\Omega_{reg}} to all 1s and train region-specific parameters
(\eqn{\Omega_{reg}}, \eqn{\Psi_{reg}}) while keeping \eqn{\Theta} and \eqn{\Phi} fixed.

The region-specific parameters allow the model to adjust predictions differently across
spatial regimes, enabling the model to capture spatial heterogeneity.
}
\section{Forward pass}{

}

\references{
Guo, H., Wang, H., Zhu, D., Wu, L., Fotheringham, A. S., & Liu, Y. (2025).
RegionGCN: Spatial-Heterogeneity-Aware Graph Convolutional Networks. Annals
of the American Association of Geographers, 1â€“17.
\url{doi:10.1080/24694452.2025.2558661}
}
